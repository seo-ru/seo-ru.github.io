nhn.LikeIt.Main=LIKE.$Class({$init:function(b,c,f,a,i,d,h,e,g){nhn.LikeIt.config.sDomain=i;nhn.LikeIt.config.sServiceId=b;this._sDisplayId=c?c:b;this._sContentId=f;this._sCategoryId=a?a:"";this._sLang=d;this._sViewType=h?h:"like";this._sCountCallbackYn=e?e:"N";this._sRparam=g?String(g).substring(0,200):"";this._sContentsYn="N";this._nCount=0;this._bLogin=false;this._sLikeItToken="";this._lTimestamp="";nhn.LikeIt.util.loadFile("css.main");nhn.LikeIt.util.loadFile("css.service",this._sDisplayId);this._buildViewTypeMessage();this._initContent();},_buildViewTypeMessage:function(){if(this._sViewType&&(this._sViewType in nhn.LikeIt.viewType)){this._traverseNodeCopy(nhn.LikeIt.viewType[this._sViewType][this._sLang],nhn.LikeIt.message[this._sLang]);}},_traverseNodeCopy:function(a,d){for(var c in a){try{if(!a[c]){return;}if((typeof(a[c])).toLowerCase()=="string"){d[c]=a[c];}else{this._traverseNodeCopy(a[c],d[c]);}}catch(b){}}},_initContent:function(){var a=nhn.LikeIt.config.sDomain+nhn.LikeIt.config.oUrl.api.content;new LIKE.$Ajax(a,{type:"jsonp",method:"get",onload:LIKE.$Fn(function(b){var d=b.json(),c=d.result;if(d.success){if(c.likeItContent){this._nCount=c.likeItContent.likeItCount;nhn.LikeIt.config.sServiceName=c.likeItContent.serviceName;}else{nhn.LikeIt.config.sServiceName=c.likeItServiceName;}if(c.likeItContentsYn){this._sContentsYn=c.likeItContentsYn;}this._bLogin=c.isLogin;this._sLikeItToken=c.likeItToken;this._lTimestamp=c.timestamp;this._setElements();}else{alert(d.error.message);}},this).bind()}).request({serviceId:nhn.LikeIt.config.sServiceId,displayId:this._sDisplayId,contentsId:this._sContentId,lang:this._sLang,viewType:this._sViewType});},_setElements:function(){this._oElement={};this._oElement.welWrapper=LIKE.$ElementList(LIKE.$$(".u_likeit_module"));this._drawButton();this._oElement.welAnchor=LIKE.$ElementList(LIKE.$$(".u_likeit_module > .u_likeit_btn"));this._oElement.welCount=LIKE.$ElementList(LIKE.$$(".u_likeit_module em"));this._attachEvent();},_formatCount:function(a){var b=nhn.LikeIt.config.sMaxCount,c=~~b.replace(/\D/g,"");if(a>c){a=b;}else{if(this._nCount){a=nhn.LikeIt.util.numberFormat(a);}}return a;},_drawButton:function(){this._oElement.welWrapper.html(nhn.LikeIt.config.oTemplate.button.process({ON:this._sContentsYn=="Y",COUNT:this._nCount,TEXT:this._nCount==0?nhn.LikeIt.config.oTemplateMessage.btnLike:this._formatCount(this._nCount)}));},_attachEvent:function(){var a=LIKE.$Fn(this._clickBtn,this);for(var b=0,c;c=this._oElement.welAnchor.get(b);b++){a.attach(c.$value(),"click");}},_clickBtn:function(d){var b=d.currentElement,a=LIKE.$Element(b),c=!a.hasClass("on");if(this._bLogin){this._btnClicked?alert(nhn.LikeIt.config.oMessage[c?"LIKE_CALLING":"LIKE_CANCELING"]):this._likeItAdd(c);}else{this._login();}d.stop();},_likeItAdd:function(b){var a=nhn.LikeIt.config.sDomain+nhn.LikeIt.config.oUrl.api[b?"contentAdd":"contentAddCancel"];LIKE.$Ajax(a,{type:"jsonp",method:"get",onload:LIKE.$Fn(function(c){var d=c.json(),e;if(d.success){if(b){this._sContentsYn=d.result.likeItContentsYn;e=String(this._formatCount(++this._nCount));e=="1"&&this._oElement.welCount.className("u_cnt");this._oElement.welCount.text(e);this._oElement.welAnchor.addClass("on");this._oElement.welAnchor.attr("onclick","nhn.LikeIt.config.nClicks(this, 'LIK.unlike', '', '', event)");}else{this._sContentsYn="N";e=String(this._formatCount(this._nCount=d.result.contents.likeItCount));this._oElement.welCount.className(e=="0"?"u_txt":"u_cnt");this._oElement.welCount.text(e=="0"?nhn.LikeIt.config.oTemplateMessage.btnLike:e);this._oElement.welAnchor.removeClass("on");this._oElement.welAnchor.attr("onclick","nhn.LikeIt.config.nClicks(this, 'LIK.like', '', '', event)");}this._btnClicked=false;}else{alert(d.message);}},this).bind()}).request({serviceId:nhn.LikeIt.config.sServiceId,displayId:this._sDisplayId,contentsId:this._sContentId,categoryId:this._sCategoryId,lang:this._sLang,timeLineShare:"N",_ch:"pcw",countCallbackYn:this._sCountCallbackYn,rparam:this._sRparam,likeItToken:this._sLikeItToken,timestamp:this._lTimestamp});this._btnClicked=true;},_login:function(){if(confirm(nhn.LikeIt.config.oMessage.NOT_AUTH)){location.href=nhn.LikeIt.config.oUrl.common.login;}}});new nhn.LikeIt.Main(__oLikeItData.serviceId,__oLikeItData.displayId,__oLikeItData.contentId,__oLikeItData.categoryId,__oLikeItData.domain,__oLikeItData.lang,__oLikeItData.viewType,__oLikeItData.countCallbackYn,__oLikeItData.rparam);